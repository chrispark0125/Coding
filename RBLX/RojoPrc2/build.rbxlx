<roblox version="4">
  <Item class="ReplicatedStorage" referent="0">
    <Properties>
      <string name="Name">ReplicatedStorage</string>
    </Properties>
    <Item class="ModuleScript" referent="1">
      <Properties>
        <string name="Name">MainModule</string>
        <string name="Source">local module = {}

local function GetBobbing(addition)
    return math.sin(tick() * addition * 1.3) * 0.5
end

function module.update(viewmodel, dt, RecoilSpring, BobbleSpring, SwayingSpring)
    viewmodel.HumanoidRootPart.CFrame = game.Workspace.Camera.CFrame

    local Bobble = Vector3.new(GetBobbing(5),GetBobbing(2),GetBobbing(2))

    local Character = game.Players.LocalPlayer.Character or game.Players.LocalPlayer.CharacterAdded:Wait()

    BobbleSpring:shove(Bobble / 10 * (Character:WaitForChild("HumanoidRootPart").Velocity.Magnitude) / 10)
    
    local UpdatedRecoilSpring = RecoilSpring:update(dt)
    local UpdatedBobbleSpring = BobbleSpring:update(dt)
    local UpdatedSwaySpring = SwayingSpring:update(dt)

    viewmodel.HumanoidRootPart.CFrame = viewmodel.HumanoidRootPart.CFrame:ToWorldSpace(CFrame.new(UpdatedBobbleSpring.Y, UpdatedBobbleSpring.X, 0))

    viewmodel.HumanoidRootPart.CFrame *= CFrame.Angles(math.rad(UpdatedRecoilSpring.X) * 2 ,math.rad(UpdatedRecoilSpring.Y),math.rad(UpdatedRecoilSpring.Z))
    game.Workspace.Camera.CFrame *= CFrame.Angles(math.rad(UpdatedRecoilSpring.X),math.rad(UpdatedRecoilSpring.Y),math.rad(UpdatedRecoilSpring.Z))
end

function module.weldgun(gun)
    local Main = gun.GunComponents.Handle

    for i, v in ipairs(gun:GetDescendants())do
        if v:IsA("BasePart") and v ~= Main then
            local NewMotor = Instance.new("Motor6D")
            NewMotor.Name = v.Name
            NewMotor.Part0 = Main
            NewMotor.Part1 = v
            NewMotor.C0 = NewMotor.Part0.CFrame:inverse() * NewMotor.Part1.CFrame
            NewMotor.Parent = Main
        end
    end
end

function module.equip(viewmodel, gun, hold)
    local GunHandle = gun.GunComponents.Handle
    local HRP_Motor6D = viewmodel:WaitForChild("HumanoidRootPart").Handle

    gun.Parent = viewmodel
    HRP_Motor6D.Part1 = GunHandle

    local Holdanim = viewmodel.AnimationController:LoadAnimation(hold)
    Holdanim:Play()
end

function  module.cast(gun, endpos, velocity)

    local Barrel = gun.GunComponents.Barrel

    local Bullet = Instance.new("Part")
    Bullet.Size = Vector3.new(0.1,0.1,0.5)
    Bullet.Anchored = true;
    Bullet.CanCollide = false;
    Bullet.Color = Color3.new(1, 0.823529, 0.443137)
    Bullet.Material = Enum.Material.Neon
    Bullet.Parent = game.Workspace

    Bullet.CFrame = CFrame.new(Barrel.Position, endpos)

    local Loop

    Loop = game:GetService("RunService").RenderStepped:Connect(function(dt)
        Bullet.CFrame *= CFrame.new(0,0, -velocity * (dt * 1))
        if(Bullet.Position - Barrel.Position).magnitude > 1000 then
            Loop:Disconnect()
            Bullet:Destroy()    
        end
    end)
end

return module</string>
      </Properties>
    </Item>
  </Item>
  <Item class="ServerScriptService" referent="2">
    <Properties>
      <string name="Name">ServerScriptService</string>
    </Properties>
  </Item>
  <Item class="StarterPlayer" referent="3">
    <Properties>
      <string name="Name">StarterPlayer</string>
    </Properties>
    <Item class="StarterCharacterScripts" referent="4">
      <Properties>
        <string name="Name">StarterCharacterScripts</string>
      </Properties>
    </Item>
    <Item class="StarterPlayerScripts" referent="5">
      <Properties>
        <string name="Name">StarterPlayerScripts</string>
      </Properties>
      <Item class="LocalScript" referent="6">
        <Properties>
          <string name="Name">LocalHandler</string>
          <string name="Source"><![CDATA[local GunModel = game.ReplicatedStorage:WaitForChild("Groza")
local ViewModel = game.ReplicatedStorage:WaitForChild("Viewmodel")
local AnimFolder = game.ReplicatedStorage:WaitForChild("Groza_Animations")

local MainModule = require(game.ReplicatedStorage.MainModule)
local SpringModule = require(game.ReplicatedStorage.SpringModule)

ViewModel.Parent = game.Workspace.Camera

MainModule.weldgun(GunModel)

local RecoilSpring = SpringModule.new()
local BobbleSpring = SpringModule.new()
local SwayingSpring = SpringModule.new()

game:GetService("RunService").RenderStepped:Connect(function(dt)
	MainModule.update(ViewModel, dt, RecoilSpring, BobbleSpring, SwayingSpring)
end)

MainModule.equip(ViewModel, GunModel, AnimFolder.Hold)

local IsPlayerHoldingMouse
local CanFire = true
local RPM = 750

game:GetService("RunService").Heartbeat:Connect(function(dt)
	if IsPlayerHoldingMouse then
		if CanFire then
			local FireDeltatick = 60/RPM
			CanFire = false
			
			RecoilSpring:shove(Vector3.new(2, math.random(-1.0,1.0),10))

			coroutine.wrap(function()
				for i, v in ipairs(GunModel.GunComponents:GetChildren())do
					if v:IsA("ParticleEmitter") then
						v:Emit()
					end
				end

				local Firesound = GunModel.GunComponents.Sounds.Fire:Clone()

				Firesound.Parent = game.Workspace
				Firesound.Parent = nil
				Firesound:Destroy()
			end)()

			coroutine.wrap(function()
				wait(0.2)
				RecoilSpring:shove(Vector3.new(-1.9, math.random(-1.0,1.0),-10))
			end)()
			
			MainModule.cast(GunModel,game.Players.LocalPlayer:GetMouse().Hit.Position,250)

			wait(FireDeltatick)
			CanFire =true
		end
	end
end)

game:GetService("UserInputService").InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		IsPlayerHoldingMouse = true
	end
end)

game:GetService("UserInputService").InputEnded:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		IsPlayerHoldingMouse = false
	end
end)	]]></string>
        </Properties>
      </Item>
      <Item class="Folder" referent="7">
        <Properties>
          <string name="Name">StarterCharacterScripts</string>
        </Properties>
      </Item>
      <Item class="LocalScript" referent="8">
        <Properties>
          <string name="Name">WalkRunHandler</string>
          <string name="Source">print("Hi")</string>
        </Properties>
      </Item>
    </Item>
  </Item>
  <Item class="Workspace" referent="9">
    <Properties>
      <string name="Name">Workspace</string>
    </Properties>
  </Item>
</roblox>